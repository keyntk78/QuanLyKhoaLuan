@model QuanLyKhoaLuan.ModelViews.SubmitFile

@{
    ViewBag.Title = "Nộp khóa luận";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row page-titles mx-0">
    <div class="col-sm-6 p-md-0">
        <div class="welcome-text">
        </div>
    </div>
    <div class="col-sm-6 p-md-0 justify-content-sm-end mt-2 mt-sm-0 d-flex">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="@Url.Action("Index","PageStudent" )">Trang chủ</a></li>
            <li class="breadcrumb-item active"><span>Nộp khóa luận</span></li>
        </ol>
    </div>
</div>

<div class="row">
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header" id="card_header">
                <h4 class="card-title">Nộp khóa luận</h4>
            </div>
            <div class="card-body">
                @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                @Html.HiddenFor(model => model.id)

                <form method="post">
                    <div class="form-group">
                        <div class="control-label col-md-2">Lưu ý:</div>
                        <div class="col-md-10">
                            <p>
                                - Nhập tên file
                                <br />
                                - Tải đúng định dạng file ".docx " hoặc ".doc" hoặc ".pdf"
                            </p>
                            <p></p>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="control-label col-md-2">File khóa luận:</div>
                        <div class="col-md-6">
                            <input name="file" hidden id="name" />
                            <div class="input-group mb-3">
                                <div class="custom-file">
                                    <input type="file" class="custom-file-input" id="fileUpload">
                                    <label class="custom-file-label" id="title_file">Chọn file</label>
                                </div>
                            </div>
                            @Html.ValidationMessageFor(model => model.file, "", new { @class = "text-danger" })
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-offset-2 col-md-10">
                            <input type="submit" value="Nộp bài" id="btnSubmit" class="btn btn-primary" />
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>



@section scripts {
    <script>
        $(function () {
            // bắt sự kiện change data của fileupload
            $('#fileUpload').change(function () {
                //kiểm tra trình duyệt có hổ trọư fomrdata
                if (window.FormData !== undefined) {
                    // lấy dử liệu trên file upload
                    var fileUpload = $('#fileUpload').get(0);
                    var files = fileUpload.files;
                    // tạo đối tượng form data
                    var file = new FormData();
                    //đưa dữ liệu vào form
                    file.append('file', files[0]);

                    $.ajax({
                        type: 'POST',
                        url: '/PageStudent/ImportFileThese',
                        contentType: false,
                        processData: false,
                        data: file,
                        success: function (res) {

                            if (res.Success) {
                                $('#name').val(res.Url);
                                $('#title_file').text(res.FileName);
                            } else {
                                Swal.fire(
                                    'Sai định dạng file!',
                                    'Thất bại.',
                                    'error'
                                )
                            }
                        },
                        error: function (e) {
                            alert("Có lỗi khi upload: " + e.statusText);
                        }
                    });

                }
            });
        });
    </script>
}